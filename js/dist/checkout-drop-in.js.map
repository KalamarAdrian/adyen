{"version":3,"sources":["../src/checkout-drop-in.js"],"names":["checkout","AdyenCheckout","pronamicPayAdyenCheckout","configuration","validate_http_status","response","status","Promise","resolve","reject","Error","statusText","get_json","json","paymentMethodsConfiguration","applepay","onValidateMerchant","validationUrl","send_request","applePayMerchantValidationUrl","validation_url","then","error","statusMessage","catch","dropin","setStatus","message","setTimeout","pronamicPayAdyenProcessing","create","onSubmit","state","paymentsUrl","data","action","handleAction","resultCode","paymentResult","onAdditionalDetails","paymentsDetailsUrl","mount","url","fetch","method","cache","headers","body","JSON","stringify","paymentAuthorised","window","location","href","paymentReturnUrl","refusalReason","paymentRefused","paymentReceived"],"mappings":"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","sourcesContent":["/* global AdyenCheckout, pronamicPayAdyenCheckout */\n( function () {\n\t'use strict';\n\n\tconst checkout = new AdyenCheckout( pronamicPayAdyenCheckout.configuration );\n\n\tconst validate_http_status = response => {\n\t\tif ( response.status >= 200 && response.status < 300 ) {\n\t\t\treturn Promise.resolve( response );\n\t\t}\n\n\t\treturn Promise.reject( new Error( response.statusText ) );\n\t};\n\n\tconst get_json = response => response.json();\n\n\tif ( pronamicPayAdyenCheckout.paymentMethodsConfiguration.applepay ) {\n\t\tpronamicPayAdyenCheckout.paymentMethodsConfiguration.applepay.onValidateMerchant = ( resolve, reject, validationUrl ) => {\n\t\t\tsend_request( pronamicPayAdyenCheckout.applePayMerchantValidationUrl, { validation_url: validationUrl } )\n\t\t\t\t.then( validate_http_status )\n\t\t\t\t.then( get_json )\n\t\t\t\t.then( response => {\n\t\t\t\t\t// Handle Pronamic Pay error.\n\t\t\t\t\tif ( response.error ) {\n\t\t\t\t\t\treturn Promise.reject( new Error( response.error ) );\n\t\t\t\t\t}\n\n\t\t\t\t\t// Handle Adyen error.\n\t\t\t\t\tif ( response.statusMessage ) {\n\t\t\t\t\t\treturn Promise.reject( new Error( response.statusMessage ) );\n\t\t\t\t\t}\n\n\t\t\t\t\treturn resolve( response );\n\t\t\t\t} )\n\t\t\t\t.catch( error => {\n\t\t\t\t\tdropin.setStatus( 'error', { message: error.message } );\n\n\t\t\t\t\tsetTimeout( () => {dropin.setStatus( 'ready' );}, 5000 );\n\n\t\t\t\t\treturn reject();\n\t\t\t\t} );\n\t\t};\n\t}\n\n\tlet pronamicPayAdyenProcessing = false;\n\n\tconst dropin = checkout.create( 'dropin', {\n\t\tpaymentMethodsConfiguration: pronamicPayAdyenCheckout.paymentMethodsConfiguration,\n\t\tonSubmit: ( state, dropin ) => {\n\t\t\tif ( pronamicPayAdyenProcessing ) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tpronamicPayAdyenProcessing = true;\n\n\t\t\tsend_request( pronamicPayAdyenCheckout.paymentsUrl, state.data )\n\t\t\t.then( validate_http_status )\n\t\t\t.then( get_json )\n\t\t\t.then( response => {\n\t\t\t\tpronamicPayAdyenProcessing = false;\n\n\t\t\t\t// Handle error.\n\t\t\t\tif ( response.error ) {\n\t\t\t\t\treturn Promise.reject( new Error( response.error ) );\n\t\t\t\t}\n\n\t\t\t\t// Handle action object.\n\t\t\t\tif ( response.action ) {\n\t\t\t\t\tdropin.handleAction( response.action );\n\t\t\t\t}\n\n\t\t\t\t// Handle result code.\n\t\t\t\tif ( response.resultCode ) {\n\t\t\t\t\tpaymentResult( response );\n\t\t\t\t}\n\t\t\t} )\n\t\t\t.catch( error => {\n\t\t\t\tdropin.setStatus( 'error', { message: error.message } );\n\n\t\t\t\tsetTimeout( () => { dropin.setStatus( 'ready' ); }, 5000 );\n\t\t\t} );\n\t\t},\n\t\tonAdditionalDetails: ( state, dropin ) => {\n\t\t\tsend_request( pronamicPayAdyenCheckout.paymentsDetailsUrl, state.data )\n\t\t\t.then( validate_http_status )\n\t\t\t.then( get_json )\n\t\t\t.then( response => {\n\t\t\t\t// Handle action object.\n\t\t\t\tif ( response.action ) {\n\t\t\t\t\tdropin.handleAction( response.action );\n\t\t\t\t}\n\n\t\t\t\t// Handle result code.\n\t\t\t\tif ( response.resultCode ) {\n\t\t\t\t\tpaymentResult( response );\n\t\t\t\t}\n\t\t\t} )\n\t\t\t.catch( error => {\n\t\t\t\tthrow Error( error );\n\t\t\t} );\n\t\t}\n\t} )\n\t.mount( '#pronamic-pay-checkout' );\n\n\tconst send_request = ( url, data ) => {\n\t\treturn fetch(\n\t\t\turl,\n\t\t\t{\n\t\t\t\tmethod: 'POST',\n\t\t\t\tcache: 'no-cache',\n\t\t\t\theaders: { 'Content-Type': 'application/json' },\n\t\t\t\tbody: JSON.stringify( data )\n\t\t\t}\n\t\t);\n\t};\n\n\tconst paymentResult = ( response ) => {\n\t\t/*\n\t\t * Handle payment result\n\t\t *\n\t\t * @link https://docs.adyen.com/checkout/drop-in-web#step-6-present-payment-result\n\t\t */\n\t\tswitch ( response.resultCode ) {\n\t\t\tcase 'Authorised':\n\t\t\t\t// The payment was successful.\n\t\t\t\tdropin.setStatus( 'success', { message: pronamicPayAdyenCheckout.paymentAuthorised } );\n\n\t\t\t\t/*\n\t\t\t\t * Inform the shopper that the payment was successful.\n\t\t\t\t */\n\t\t\t\twindow.location.href = pronamicPayAdyenCheckout.paymentReturnUrl;\n\n\t\t\t\tbreak;\n\t\t\tcase 'Error':\n\t\t\t\t// Inform the shopper that there was an error processing their payment.\n\n\t\t\t\t/*\n\t\t\t\t * You'll receive a `refusalReason` in the same response, indicating the cause of the error.\n\t\t\t\t */\n\t\t\t\tif ( response.refusalReason ) {\n\t\t\t\t\tdropin.setStatus( 'error', { message: response.refusalReason } );\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\t\t\tcase 'Pending':\n\t\t\t\t// The shopper has completed the payment but the final result is not yet known.\n\n\t\t\t\t/*\n\t\t\t\t * Inform the shopper that you've received their order, and are waiting for the payment to be completed.\n\t\t\t\t */\n\t\t\t\twindow.location.href = pronamicPayAdyenCheckout.paymentReturnUrl;\n\n\t\t\t\tbreak;\n\t\t\tcase 'PresentToShopper':\n\t\t\t\t// Present the voucher or the QR code to the shopper.\n\n\t\t\t\t/*\n\t\t\t\t * For a voucher payment method, inform the shopper that you are waiting for their payment. You will receive the final result of the payment in an AUTHORISATION notification.\n\t\t\t\t *\n\t\t\t\t * For a qrCode payment method, wait for the AUTHORISATION notification before presenting the payment result to the shopper.\n\t\t\t\t *\n\t\t\t\t * @todo\n\t\t\t\t */\n\t\t\t\tbreak;\n\t\t\tcase 'Refused':\n\t\t\t\t// The payment was refused.\n\n\t\t\t\t/*\n\t\t\t\t * Inform the shopper that the payment was refused. Ask the shopper to try the payment again using a different payment method or card.\n\t\t\t\t */\n\t\t\t\tdropin.setStatus( 'error', { message: pronamicPayAdyenCheckout.paymentRefused + ' (' + response.refusalReason + ')' } );\n\n\t\t\t\tsetTimeout(\n\t\t\t\t\t() => {\n\t\t\t\t\t\tdropin.setStatus( 'ready' );\n\t\t\t\t\t},\n\t\t\t\t\t8000\n\t\t\t\t);\n\n\t\t\t\tbreak;\n\t\t\tcase 'Received':\n\t\t\t\t// For some payment methods, it can take some time before the final status of the payment is known.\n\t\t\t\tdropin.setStatus( 'success', { message: pronamicPayAdyenCheckout.paymentReceived } );\n\n\t\t\t\t/*\n\t\t\t\t * Inform the shopper that you've received their order, and are waiting for the payment to clear.\n\t\t\t\t */\n\t\t\t\tsetTimeout(\n\t\t\t\t\t() => {\n\t\t\t\t\t\twindow.location.href = pronamicPayAdyenCheckout.paymentReturnUrl;\n\t\t\t\t\t},\n\t\t\t\t\t3000\n\t\t\t\t);\n\n\t\t\t\tbreak;\n\t\t}\n\t};\n} )();\n"],"file":"checkout-drop-in.js"}